# é‡‘èžæ–‡æœ¬ç›¸ä¼¼åº¦åˆ†ç±»ç«žèµ› - ä¼˜åŒ–æ–¹æ¡ˆ

## ðŸŽ¯ ç›®æ ‡

å°†æ¨¡åž‹å‡†ç¡®çŽ‡ä»ŽåŸºçº¿**0.764**æå‡è‡³**0.85+**ï¼Œé€šè¿‡ç»¼åˆä¼˜åŒ–ç­–ç•¥å®žçŽ°æ˜¾è‘—æ€§èƒ½æå‡ã€‚

## âš¡ ä¸€é”®éƒ¨ç½²ï¼ˆæŽ¨èï¼‰

**åªéœ€ä¸€è¡Œå‘½ä»¤ï¼Œè‡ªåŠ¨å®ŒæˆçŽ¯å¢ƒé…ç½®ã€ä¾èµ–å®‰è£…å’Œå®Œæ•´è®­ç»ƒæµç¨‹ï¼**

```bash
# ä¸€é”®éƒ¨ç½²ï¼ˆåŒ…å«çŽ¯å¢ƒæ£€æŸ¥ã€ä¾èµ–å®‰è£…ã€æ•°æ®å¤„ç†ã€è®­ç»ƒã€æŽ¨ç†ã€è¯„ä¼°ï¼‰
python deploy.py
```

**éƒ¨ç½²æµç¨‹ï¼š**
1. ðŸ” è‡ªåŠ¨æ£€æµ‹ç³»ç»ŸçŽ¯å¢ƒå’ŒGPU
2. ðŸ“¦ æ™ºèƒ½å®‰è£…é¡¹ç›®ä¾èµ–
3. âœ… éªŒè¯å®‰è£…çŽ¯å¢ƒ
4. ðŸš€ æ‰§è¡Œå®Œæ•´è®­ç»ƒæµç¨‹ï¼ˆæ•°æ®â†’è®­ç»ƒâ†’æŽ¨ç†â†’è¯„ä¼°ï¼‰
5. ðŸ“Š æ˜¾ç¤ºè®­ç»ƒç»“æžœå’Œç«žèµ›æäº¤æŒ‡å¯¼

**é¢„è®¡è€—æ—¶ï¼š** 90åˆ†é’Ÿ | **é¢„æœŸå‡†ç¡®çŽ‡ï¼š** 0.85+

## ðŸ“ é¡¹ç›®ç»“æž„

```
model_training/
â”œâ”€â”€ deploy.py                  # ðŸ†• ä¸€é”®éƒ¨ç½²è„šæœ¬
â”œâ”€â”€ main.py                    # ä¸»éƒ¨ç½²è„šæœ¬
â”œâ”€â”€ requirements.txt           # ä¾èµ–åˆ—è¡¨
â”œâ”€â”€ config/                    # ðŸ†• é…ç½®æ–‡ä»¶ç›®å½•
â”‚   â”œâ”€â”€ train_config.json      # è®­ç»ƒé…ç½®
â”‚   â””â”€â”€ environment.json       # çŽ¯å¢ƒé…ç½®
â”œâ”€â”€ scripts/                   # æ ¸å¿ƒè„šæœ¬
â”‚   â”œâ”€â”€ __init__.py           # è„šæœ¬åŒ…åˆå§‹åŒ–
â”‚   â”œâ”€â”€ data_processor.py     # æ•°æ®ä¸‹è½½å’Œåˆ†æž
â”‚   â”œâ”€â”€ model_trainer.py      # æ¨¡åž‹è®­ç»ƒå’ŒæŽ¨ç†
â”‚   â”œâ”€â”€ evaluate.py           # æ€§èƒ½è¯„ä¼°
â”‚   â””â”€â”€ utils.py              # å·¥å…·å‡½æ•°
â”œâ”€â”€ data/                     # æ•°æ®æ–‡ä»¶
â”‚   â”œâ”€â”€ train.jsonl           # è®­ç»ƒæ•°æ®
â”‚   â””â”€â”€ test.jsonl            # æµ‹è¯•æ•°æ®
â”œâ”€â”€ models/                   # æ¨¡åž‹è¾“å‡ºç›®å½•
â”œâ”€â”€ results/                  # åˆ†æžç»“æžœ
â”‚   â”œâ”€â”€ dataset_analysis/     # æ•°æ®é›†åˆ†æž
â”‚   â”œâ”€â”€ evaluation_results/   # è¯„ä¼°ç»“æžœ
â”‚   â””â”€â”€ enhanced_result.jsonl # ç«žèµ›æäº¤æ–‡ä»¶
â”œâ”€â”€ logs/                     # æ—¥å¿—æ–‡ä»¶
â””â”€â”€ docs/                     # æ–‡æ¡£
```

## ðŸš€ å¿«é€Ÿå¼€å§‹

### 1. ä¸€é”®éƒ¨ç½²ï¼ˆæœ€ç®€å•ï¼‰
```bash
# è‡ªåŠ¨æ£€æµ‹çŽ¯å¢ƒï¼Œå®‰è£…ä¾èµ–ï¼Œå®Œæ•´è®­ç»ƒæµç¨‹
python deploy.py
```

### 2. æ ‡å‡†éƒ¨ç½²æµç¨‹
```bash
# æ–¹å¼1: è‡ªåŠ¨å®‰è£…è„šæœ¬ï¼ˆæŽ¨èï¼‰
python install_deps.py

# æ–¹å¼2: æ‰‹åŠ¨å®‰è£…
pip install -r requirements.txt

# é­”æ­å¹³å°ç‰¹æ®Šå¤„ç†
python fix_modelscope_deps.py

# éªŒè¯å®‰è£…
python test_setup.py
```

#### é­”æ­å¹³å°æ³¨æ„äº‹é¡¹
å¦‚æžœåœ¨é­”æ­å¹³å°é‡åˆ°ä¾èµ–å†²çªï¼š
```bash
# è‡ªåŠ¨ä¿®å¤è„šæœ¬
python fix_modelscope_deps.py

# æˆ–è·³è¿‡çŽ¯å¢ƒæ£€æŸ¥ç›´æŽ¥è¿è¡Œ
python main.py --skip-env-check --step all
```

### 3. æ‰§è¡Œè®­ç»ƒæµç¨‹
```bash
# ðŸš¨ æŽ¨èï¼šä½¿ç”¨é”™è¯¯ç›‘æŽ§æ¨¡å¼ï¼ˆé‡åˆ°é”™è¯¯è‡ªåŠ¨åœæ­¢å¹¶æ˜¾ç¤ºè¯¦ç»†ä¿¡æ¯ï¼‰
python stop_on_error.py all          # å®Œæ•´æµç¨‹ç›‘æŽ§
python stop_on_error.py train        # è®­ç»ƒè¿‡ç¨‹ç›‘æŽ§
python stop_on_error.py analysis     # æ•°æ®åˆ†æžç›‘æŽ§

# æ ‡å‡†æ‰§è¡Œï¼ˆä¼ ç»Ÿæ–¹å¼ï¼‰
python main.py --step all

# å¦‚æžœçŽ¯å¢ƒæ£€æŸ¥æœ‰é—®é¢˜ï¼Œå¯ä»¥è·³è¿‡
python main.py --skip-env-check --step all

# åˆ†æ­¥æ‰§è¡Œ
python main.py --step analysis    # æ•°æ®åˆ†æž
python main.py --step train       # æ¨¡åž‹è®­ç»ƒ
python main.py --step inference   # æ¨¡åž‹æŽ¨ç†
python main.py --step evaluate    # æ€§èƒ½è¯„ä¼°
```

#### ç›‘æŽ§æ¨¡å¼ç‰¹ç‚¹
- ðŸ” **å®žæ—¶ç›‘æŽ§**: è‡ªåŠ¨æ£€æµ‹é”™è¯¯å…³é”®è¯
- ðŸ›‘ **æ™ºèƒ½åœæ­¢**: é‡åˆ°é”™è¯¯ç«‹å³åœæ­¢å¹¶æ˜¾ç¤ºè¯¦ç»†ä¿¡æ¯
- ðŸ“ **å®Œæ•´æ—¥å¿—**: ä¿å­˜æ‰€æœ‰è¾“å‡ºåˆ°æ—¥å¿—æ–‡ä»¶
- ðŸ’¡ **è§£å†³å»ºè®®**: æä¾›é’ˆå¯¹æ€§çš„ä¿®å¤å»ºè®®

### 4. æ‰‹åŠ¨æ‰§è¡Œå„æ¨¡å—
```bash
# æ•°æ®å¤„ç†
python scripts/data_processor.py all

# æ¨¡åž‹è®­ç»ƒ
python scripts/model_trainer.py train

# æ¨¡åž‹æŽ¨ç†
python scripts/model_trainer.py inference

# æ€§èƒ½è¯„ä¼°
python scripts/evaluate.py
```

### 5. è°ƒè¯•å’Œè¯Šæ–­
```bash
# ðŸ› è¿è¡Œå®Œæ•´é¡¹ç›®è¯Šæ–­
python debug.py

# ðŸ” æµ‹è¯•çŽ¯å¢ƒå’Œä¾èµ–
python test_setup.py

# ðŸ”§ ä¿®å¤PyArrowå…¼å®¹æ€§é—®é¢˜
python fix_pyarrow_manual.py

# ðŸ”§ ä¿®å¤datasetså…¼å®¹æ€§é—®é¢˜
python fix_datasets_compatibility.py

# ðŸ“Š æµ‹è¯•è¡¥ä¸æ•ˆæžœ
python test_pyarrow_patch.py
```

## ðŸ’» ç³»ç»Ÿè¦æ±‚

### æœ€ä½Žé…ç½®
- **Python**: 3.8+
- **å†…å­˜**: 16GB RAM
- **å­˜å‚¨**: 50GB å¯ç”¨ç©ºé—´
- **ç½‘ç»œ**: ç¨³å®šçš„äº’è”ç½‘è¿žæŽ¥

### æŽ¨èé…ç½®
- **Python**: 3.10+
- **å†…å­˜**: 32GB RAM
- **GPU**: NVIDIA GPU with 8GB+ VRAM (æŽ¨è RTX 3060/3070/3080 æˆ– A100)
- **CUDA**: 11.8+ (å¦‚æžœä½¿ç”¨GPU)

### æ”¯æŒå¹³å°
- âœ… **é­”æ­å¹³å°** (ModelScope)
- âœ… **Linux** (Ubuntu 18.04+)
- âœ… **macOS** (10.15+)
- âœ… **Windows** (10/11 with WSL2)

## ðŸ“Š é¢„æœŸæ€§èƒ½

| é…ç½® | å‡†ç¡®çŽ‡ | é¢„æœŸæŽ’å | è®­ç»ƒæ—¶é—´ |
|------|--------|----------|----------|
| åŸºçº¿ | 0.764 | - | - |
| ä¼˜åŒ–ç‰ˆ | 0.85+ | å‰30å | ~90åˆ†é’Ÿ |
| é«˜çº§ä¼˜åŒ– | 0.90+ | å‰20å | ~120åˆ†é’Ÿ |

## ðŸŽ¯ æ ¸å¿ƒä¼˜åŒ–ç­–ç•¥

### Promptä¼˜åŒ–
- æ›´æ¸…æ™°çš„é‡‘èžè¯­å¢ƒæŒ‡å¯¼
- æ˜Žç¡®çš„è¾“å‡ºæ ¼å¼è¦æ±‚
- ä¸“ä¸šçš„ä»»åŠ¡æè¿°

### è¶…å‚æ•°è°ƒä¼˜
- å­¦ä¹ çŽ‡ï¼š1.8e-4ï¼ˆå¹³è¡¡æ”¶æ•›å’Œç¨³å®šæ€§ï¼‰
- LoRAé…ç½®ï¼šrank=16, alpha=32
- è®­ç»ƒè½®æ•°ï¼š5è½®ï¼ˆæ—©åœæœºåˆ¶ï¼‰
- æ‰¹æ¬¡å¤§å°ï¼šæœ‰æ•ˆbatch_size=16

### æŽ¨ç†ä¼˜åŒ–
- æ™ºèƒ½è¾“å‡ºåŽå¤„ç†
- å¼‚å¸¸å€¼å¤„ç†å’Œæ¸…æ´—
- ç¡®å®šæ€§æŽ¨ç†ï¼ˆtemperature=0ï¼‰

### è®­ç»ƒç­–ç•¥
- éªŒè¯é›†è¯„ä¼°å’Œæ—©åœ
- ä½™å¼¦å­¦ä¹ çŽ‡è°ƒåº¦
- æ¢¯åº¦ç´¯ç§¯å’Œæ£€æŸ¥ç‚¹

## ðŸ† ç«žèµ›æäº¤

### è‡ªåŠ¨æäº¤å‡†å¤‡
ä¸€é”®éƒ¨ç½²å®ŒæˆåŽï¼Œç»“æžœæ–‡ä»¶ä¼šè‡ªåŠ¨ç”Ÿæˆåœ¨æ­£ç¡®ä½ç½®ï¼š

```bash
# æ£€æŸ¥ç»“æžœæ–‡ä»¶æ˜¯å¦ç”Ÿæˆ
ls -la results/

# å¦‚æžœä½¿ç”¨ä¸€é”®éƒ¨ç½²ï¼Œæ–‡ä»¶å·²å‡†å¤‡å¥½
# ç›´æŽ¥æäº¤ results/enhanced_result.jsonl å³å¯
```

### æ‰‹åŠ¨æäº¤å‡†å¤‡
å¦‚æžœä½¿ç”¨åˆ†æ­¥æ‰§è¡Œï¼Œéœ€è¦æ‰‹åŠ¨å¤åˆ¶ç»“æžœï¼š

```bash
# è½¬æ¢ç»“æžœæ ¼å¼ï¼ˆå¦‚æžœéœ€è¦ï¼‰
cp results/enhanced_result.jsonl results/result.json

# æäº¤ result.json åˆ°ç«žèµ›é¡µé¢
```

### æäº¤æ£€æŸ¥æ¸…å•
- âœ… ç»“æžœæ–‡ä»¶å­˜åœ¨: `results/enhanced_result.jsonl`
- âœ… æ–‡ä»¶æ ¼å¼æ­£ç¡®: JSONL æ ¼å¼ï¼Œæ¯è¡Œä¸€ä¸ªé¢„æµ‹ç»“æžœ
- âœ… é¢„æµ‹æ•°é‡æ­£ç¡®: 3000æ¡æµ‹è¯•æ ·æœ¬
- âœ… è¾“å‡ºæ ¼å¼æ­£ç¡®: æ¯è¡ŒåªåŒ…å«æ•°å­— 0 æˆ– 1

## ðŸ“‹ è¯¦ç»†è¯´æ˜Ž

### æ•°æ®é›†ä¿¡æ¯
- è®­ç»ƒé›†ï¼š32,000æ¡æ ·æœ¬
- æµ‹è¯•é›†ï¼š3,000æ¡æ ·æœ¬
- ç±»åˆ«åˆ†å¸ƒï¼šç›¸ä¼¼(1): 41.4%, ä¸ç›¸ä¼¼(0): 58.6%

### æ¨¡åž‹é…ç½®
- åŸºç¡€æ¨¡åž‹ï¼šQwen/Qwen3-4B-Instruct-2507
- å¾®è°ƒæ–¹æ³•ï¼šLoRA
- è®­ç»ƒå‚æ•°ï¼šè¯¦ç»†é…ç½®è§`scripts/model_trainer.py`

### è¯„ä¼°æŒ‡æ ‡
- å‡†ç¡®çŽ‡ (Accuracy)
- ç²¾ç¡®çŽ‡/å¬å›žçŽ‡/F1 (Precision/Recall/F1)
- æ··æ·†çŸ©é˜µåˆ†æž

## ðŸ”§ æ•…éšœæŽ’é™¤

### ðŸš¨ ä¸€é”®éƒ¨ç½²å¤±è´¥ï¼Ÿ
å¦‚æžœ `python deploy.py` å¤±è´¥ï¼š

1. **æ£€æŸ¥Pythonç‰ˆæœ¬**ï¼š
   ```bash
   python --version  # åº”ä¸º 3.8+
   ```

2. **æ‰‹åŠ¨æ‰§è¡Œå„æ­¥éª¤**ï¼š
   ```bash
   # 1. å®‰è£…ä¾èµ–
   python install_deps.py

   # 2. éªŒè¯çŽ¯å¢ƒ
   python test_setup.py

   # 3. æ‰§è¡Œè®­ç»ƒ
   python main.py --step all
   ```

3. **æŸ¥çœ‹è¯¦ç»†æ—¥å¿—**ï¼š
   ```bash
   # æŸ¥çœ‹å®‰è£…æ—¥å¿—
   cat logs/deps.log

   # æŸ¥çœ‹çŽ¯å¢ƒæ—¥å¿—
   cat logs/env.log

   # æŸ¥çœ‹è®­ç»ƒæ—¥å¿—
   tail -f logs/train.log
   ```

### å¸¸è§é—®é¢˜

1. **PyArrowå…¼å®¹æ€§é”™è¯¯** (`AttributeError: module 'pyarrow' has no attribute 'PyExtensionType'`)ï¼š
   ```bash
   # ä¸€é”®ä¿®å¤ï¼ˆæŽ¨èï¼‰
   python fix_pyarrow_manual.py

   # æˆ–åˆ†æ­¥æ‰‹åŠ¨ä¿®å¤
   pip uninstall -y datasets pyarrow
   pip install 'pyarrow>=8.0.0,<12.0.0'
   pip install 'datasets==2.14.0'

   # éªŒè¯ä¿®å¤
   python -c "import datasets; print('æˆåŠŸ')"
   ```

   **å¦‚æžœè¿˜å¤±è´¥**ï¼š
   ```bash
   # è®¾ç½®çŽ¯å¢ƒå˜é‡åŽè¿è¡Œ
   PYTHONPATH=site_packages python fix_pyarrow_manual.py

   # æµ‹è¯•è¡¥ä¸æ•ˆæžœ
   python test_pyarrow_patch.py
   ```

2. **NumPyå…¼å®¹æ€§é”™è¯¯** (`A module that was compiled using NumPy 1.x cannot be run in NumPy 2.3.5`):
   ```bash
   # ä¸€é”®ä¿®å¤NumPyå…¼å®¹æ€§
   python fix_numpy_compatibility.py

   # æˆ–æ‰‹åŠ¨é™çº§NumPy
   pip uninstall numpy
   pip install 'numpy<2.0.0'

   # éªŒè¯ä¿®å¤
   python -c "import numpy as np; print('NumPy:', np.__version__)"
   ```

3. **Datasetså…¼å®¹æ€§é”™è¯¯** (`ImportError: cannot import name 'LargeList'`):
   ```bash
   # ä¸€é”®ä¿®å¤datasetså…¼å®¹æ€§
   python fix_datasets_compatibility.py

   # æˆ–æ‰‹åŠ¨ä¿®å¤
   pip uninstall -y datasets
   pip install 'datasets>=2.10.0,<2.17.0'

   # éªŒè¯ä¿®å¤
   python -c "from modelscope import MsDataset; print('æˆåŠŸ')"
   ```

2. **æ•°æ®é›†ä¸‹è½½å¤±è´¥**ï¼š
   ```bash
   # ä½¿ç”¨å¤‡ç”¨æ•°æ®ä¸‹è½½
   python scripts/data_processor.py download
   ```

3. **GPUå†…å­˜ä¸è¶³**ï¼š
   - å‡å° `per_device_train_batch_size` (é…ç½®æ–‡ä»¶ä¸­)
   - å¢žåŠ  `gradient_accumulation_steps`
   - æˆ–ä½¿ç”¨CPUè®­ç»ƒï¼ˆå¾ˆæ…¢ï¼‰

4. **ä¾èµ–ç‰ˆæœ¬å†²çª**ï¼š
   ```bash
   # å‡çº§å…³é”®ä¾èµ–
   pip install --upgrade torch transformers

   # æˆ–ä½¿ç”¨ä¿®å¤è„šæœ¬
   python fix_modelscope_deps.py
   ```

4. **ç½‘ç»œé—®é¢˜**ï¼š
   - æ£€æŸ¥ç½‘ç»œè¿žæŽ¥
   - é­”æ­å¹³å°å¯èƒ½éœ€è¦ä»£ç†

### è°ƒè¯•æŠ€å·§
- **å®žæ—¶ç›‘æŽ§**: `tail -f logs/train.log`
- **GPUç›‘æŽ§**: `watch -n 1 nvidia-smi`
- **å†…å­˜ç›‘æŽ§**: `htop` æˆ– `top`
- **çŽ¯å¢ƒéªŒè¯**: `python -c "import torch; print('CUDA:', torch.cuda.is_available())"`

## ðŸ“ˆ æ€§èƒ½ç›‘æŽ§

### è®­ç»ƒç›‘æŽ§
```bash
# æŸ¥çœ‹å®žæ—¶è®­ç»ƒè¿›åº¦
tail -f logs/train.log

# ç›‘æŽ§GPUä½¿ç”¨
watch -n 1 nvidia-smi
```

### è¯„ä¼°ç»“æžœ
è®­ç»ƒå®ŒæˆåŽï¼Œè¯„ä¼°ç»“æžœä¿å­˜åœ¨`results/evaluation_results/`ç›®å½•ä¸­ï¼š
- `evaluation_report.json` - è¯¦ç»†è¯„ä¼°æŠ¥å‘Š
- `confusion_matrix.png` - æ··æ·†çŸ©é˜µå¯è§†åŒ–
- `error_analysis.png` - é”™è¯¯åˆ†æžå›¾è¡¨

## ðŸŽ‰ å¼€å§‹ç«žèµ›ï¼

**ç›®æ ‡ï¼š90åˆ†é’Ÿå†…è¾¾åˆ°0.85+å‡†ç¡®çŽ‡ï¼Œå†²åˆºå‰30åï¼**

### ðŸ’¡ ä½¿ç”¨å»ºè®®

#### ðŸš€ æ–°æ‰‹æŽ¨è
```bash
# ç¬¬ä¸€é€‰æ‹©ï¼šä¸€é”®éƒ¨ç½²ï¼Œæœ€ç®€å•
python deploy.py

# ç¬¬äºŒé€‰æ‹©ï¼šæ ‡å‡†æµç¨‹
python main.py --step all
```

#### ðŸ”§ å¼€å‘è€…é€‰é¡¹
1. **åˆæ¬¡è¿è¡Œ**ï¼šä½¿ç”¨ `python deploy.py` ä¸€é”®éƒ¨ç½²
2. **è°ƒè¯•ä¼˜åŒ–**ï¼šåˆ†æ­¥æ‰§è¡Œï¼Œè§‚å¯Ÿæ¯æ­¥ç»“æžœ
   ```bash
   python main.py --step analysis   # å…ˆåˆ†æžæ•°æ®
   python main.py --step train      # å•ç‹¬è®­ç»ƒ
   python main.py --step inference  # æµ‹è¯•æŽ¨ç†
   python main.py --step evaluate   # æŸ¥çœ‹è¯„ä¼°
   ```
3. **æ€§èƒ½è°ƒä¼˜**ï¼šæ ¹æ®è¯„ä¼°ç»“æžœè°ƒæ•´ `config/train_config.json`
4. **ç«žèµ›æäº¤**ï¼šç¡®ä¿ä½¿ç”¨æœ€ä½³æ¨¡åž‹è¿›è¡ŒæŽ¨ç†

#### âš¡ å¿«é€Ÿæ£€æŸ¥
```bash
# æ£€æŸ¥GPUå’ŒçŽ¯å¢ƒ
python -c "import torch; print(f'CUDA: {torch.cuda.is_available()}')"

# æŸ¥çœ‹è®­ç»ƒè¿›åº¦
tail -f logs/train.log

# æ£€æŸ¥ç»“æžœ
ls -la results/
```

---

**ç¥ç«žèµ›æˆåŠŸï¼ðŸš€**
